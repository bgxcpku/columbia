\documentclass[11pt]{article}
\usepackage{geometry}                % See geometry.pdf to learn the layout options. There are lots.
\geometry{letterpaper}                   % ... or a4paper or a5paper or ... 
%\geometry{landscape}                % Activate for for rotated page geometry
%\usepackage[parfill]{parskip}    % Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{epstopdf}
\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}

\title{Notes on Parimutuel Betting}
\author{David Pfau}
%\date{}                                           % Activate to display a given date or no date

\begin{document}
\maketitle
%\section{}
%\subsection{}

Suppose a gambler is betting on a discrete set of possible outcomes and knows the true probability vector $\vec{\pi}$ of the outcomes.  If others have bet a total amount of money $\vec{v}$ and the gambler distributes his\footnote{Totally gender normative and not ashamed.  How many women do you see at horse races?} money according to $\vec{w}$, the expected returns are equal to $\sum_i \pi_i \frac{w_i}{w_i + v_i} \sum_{j} v_j + w_j$.  Given a fixed total capital $W = \sum_i w_i$, what is the optimal distribution of bets $\vec{w}$?  The second sum in the expected returns does not change, so the optimization problem is to maximize $r(\vec{w}) =\sum_i \pi_i \left(1 + \frac{v_i}{w_i}\right)^{-1}$ given $\sum_i w_i = W$.

Taking the gradient of $r(\vec{w})$ gives

\[ \frac{\partial}{\partial w_i} r(\vec{w}) = \frac{\pi_i v_i}{(w_i + v_i)^2}\]

Meanwhile the gradient of the constraint is just $\vec{w}$.  So by the method of Lagrange multipliers we want:

\[ \frac{\pi_i v_i}{(w_i + v_i)^2} = -\lambda w_i \]
\[ \pi_i v_i = -\lambda w_i (w_i^2 + 2w_i v_i + v_i^2) \]
\[ \lambda w_i^3 + 2\lambda v_i w_i^2 + (\lambda v_i^2 + \pi_i v_i) = 0\]

This is however assuming that it is optimal to use all the available capital.

What if the amount of capital is limitless?  Then we want to maximize expected profit: $s(\vec{w}) = \left(\sum_i \pi_i \left(1 + \frac{v_i}{w_i}\right)^{-1}\sum_j v_j + w_j \right) - \sum_i w_i$.  The partial derivatives are:

\[ \frac{\partial}{\partial w_i} s(\vec{w}) = \frac{\pi_i v_i}{(w_i + v_i)^2} \sum_j (v_j + w_j) + \sum_j\pi_j \left(1 + \frac{v_j}{w_j}\right)^{-1} - 1 \]

Say $\vec{v} + \vec{w} = k\vec{\pi}$, then the above simplifies to

\[ -\frac{w_i}{k\pi_i} + \sum_j \frac{w_j}{k} \]

And it is optimal to choose $w_i = \pi_i \sum_j w_j$, that is, $w_i \propto \pi_i$.  Let $\vec{v} = a\vec{\pi}$, $\vec{w} = b\vec{\pi}$, then the expected profit is exactly 0.

Say $\vec{v} = a\vec{\pi}$, then the gradient simplifies to 

\[ \frac{a\pi_i^2}{(w_i + a\pi_i)^2} \left(a + \sum_j w_j\right) + \sum_j \left(1+ \frac{a\pi_j}{w_j}\right)^{-1} - 1 \]

Taking as an ansatz $\vec{w} = b\vec{\pi}$, the gradient is equal to 0 and this is the optimum.  Plugging in to the expected profit we get exactly 0: when the odds are correct there is no expected gain to betting.  What if $\vec{v}$ is not proportional to $\vec{\pi}$?  If we choose $\vec{w}$ such that $\vec{w} + \vec{v} = k\vec{\pi}$ then the gradient again reduces to 0.  Now, the expected profit is

\[ \sum_i \pi_i \left(1 + \frac{v_i}{k\pi_i - v_i}\right)^{-1}k - \left(k - \sum_i v_i\right) = \sum_i  k\pi_i - v_i - k + \sum_i v_i = 0\]

Which seems completely wrong!  I must have made a mistake somewhere...

\end{document}  