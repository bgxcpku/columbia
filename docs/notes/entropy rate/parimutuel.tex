\documentclass[11pt]{article}
\usepackage{geometry}                % See geometry.pdf to learn the layout options. There are lots.
\geometry{letterpaper}                   % ... or a4paper or a5paper or ... 
%\geometry{landscape}                % Activate for for rotated page geometry
%\usepackage[parfill]{parskip}    % Activate to begin paragraphs with an empty line rather than an indent
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{epstopdf}
\DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}

\title{Notes on Optimal Parimutuel Betting}
\author{David Pfau}
%\date{}                                           % Activate to display a given date or no date

\begin{document}
\maketitle
%\section{}
%\subsection{}

Suppose a gambler is betting on a discrete set of $n$ possible outcomes and knows the true probability vector $\vec{\pi}$ of the outcomes.  If others have bet a total amount of money $\vec{v}$ and the gambler distributes his money according to $\vec{w}$, the expected returns are equal to 

\begin{equation}
r(\vec{w}) = \sum_i \pi_i \frac{w_i}{w_i + v_i} \sum_{j} v_j + w_j - \sum_i w_i = \sum_i w_i \left( \frac{\pi_i \sum_j v_j + w_j}{v_i + w_i} - 1\right)
\label{eq:returns}
\end{equation}

Clearly, if we scale both $\vec{v}$ and $\vec{w}$ by a constant factor the expected returns are scaled by the same amount, and w.l.o.g. we can assume that $\sum_i v_i = 1$ and (\ref{eq:returns}) simplifies to 

\begin{equation}
 \sum_i w_i \left( \frac{\pi_i (1+ \sum_j w_j)}{v_i + w_i} - 1\right)
\label{eq:normal_returns}
\end{equation}

The partial derivatives of this are

\begin{equation}
\frac{\partial r}{\partial w_i}=\frac{\pi_i v_i}{(w_i + v_i)^2}\left(1+\sum_j w_j\right) + \sum_j \frac{\pi_j w_j}{v_j + w_j} - 1
\label{eq:partials}
\end{equation}

The optimal bet is when, for all $i$, either $\partial r/\partial w_i = 0$ and $w_i > 0$ or $w_i = 0$.  Note that the $\sum_j$ terms in (\ref{eq:partials}) do not depend at all on $i$, and thus the condition that the partial derivative is 0 implies that $\pi_i v_i/(w_i+v_i)^2 = \pi_{i'} v_{i'}/(w_{i'} + v_{i'})^2$ for all $i$, $i'$ such that $w_i, w_{i'} \ne 0$.  Call this constant $k$.  We can rewrite the second $\sum_j$ term in (\ref{eq:partials}) as $k\sum_j w_j$, since either $w_j = 0$ and it is trivially true or the derivative w.r.t. $w_j$ equals $\pi_j v_j/(w_j + v_j)^2 = k$.  Then, solving for k, we find that

\begin{equation}
\frac{\pi_i v_i}{(w_i + v_i)^2} = \frac{1}{1+2\sum_j w_j} \Rightarrow \sqrt{\pi_i v_i (1+ 2\sum_j w_j)} -v_i = w_i
\label{eq:optimum}
\end{equation}

Which gives us a series of simultaneous quadratic equations.  In general it may not be possible to find a closed form solution to this.  While we could in practice iteratively assign bets out of some large pool of money and then update the total amount of money allocated, this does not have the satisfying universality of a closed solution.  We can however make some statements about optimal betting.  For example, since $\sum_j w_j \ge 0$, if $v_i > \pi_i$ then $\sqrt{\pi_i v_i (1 + 2\sum_j w_j)} < v_i$ and the intuition that one should not bet on an outcome with worse than true odds is upheld.  Interestingly, it may not be optimal to bet on something with better than true odds, if enough money is placed on other outcomes with even better odds.  Moreover, if $v_i = \pi_i$, then the solution is clearly 0 for all $w_i$, and there is no advantage to betting on perfect odds.

We can bound the behavior of optimal gamblers by taking a simple lower bound to the bets placed by one gambler.  Ignore the $w_j$ terms on the right side of (\ref{eq:optimum}), then the suboptimal bet is simply $\sqrt{\pi_i v_i} - v_i < w_i$.  If we seed the pool and then have an infinite sequence of gamblers placing bets, renormalizing each time, the updates for the pool are

\begin{equation}
v'_i \leftarrow 
\begin{cases}
\sqrt{\pi_i v_i} & \text{if $v_i < \pi_i$} \\
 v_i & \text{if $v_i \ge \pi_i$}
\end{cases}
\end{equation}
\begin{equation}
v_i \leftarrow \frac{v'_i}{\sum_j v'_j}
\end{equation}

Which clearly has fixed points $v_i = \pi_i$.  Since the lower bound on the optimal bets converges to the true distribution as more bets are placed, and $v_i = \pi_i$ is a fixed point for the optimal strategy, the proportion of bets on each outcome will converge to the true probability of those outcomes if an infinite number of optimal gamblers place bets sequentially.

\end{document}  