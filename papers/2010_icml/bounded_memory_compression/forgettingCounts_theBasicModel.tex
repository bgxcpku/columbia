
\section{The basic model}

\subsection{Pitman-Yor Process}

The building block for the models we employ is the Pitman-Yor process.  The Pitman-Yor process is a generalization of the Dirichlet process and can be thought of as a distribution over distributions with three parameters.  If $\G_1 \sim \PY(d,c,\G_0)$ we say $\G_1$ is a random distribution distributed according to a Pitman-Yor process with discount parameter $d$, concentration parameter $c$, and base measure $\G_0$. The Pitman-Yor process reduces to the Dirichlet process when $d = 0$ \cite{Pitman}.

A sample of size $n$ can be drawn from a distribution $\G_1\sim \PY(d,c,\G_0)$ through a process known as the Chinese restaurant process.  This process avoids instantiating the distribution $\G_1$ by marginalizing it out and drawing dependent samples.  It is called a restaurant process because of the metaphor that each observation is a customer seated in a restaurant with infinitely many tables. The process is initiated by seating $x_1$ at an empty table. Subsequently $x_2 \ldots x_n$ are seated sequentially, each at a currently occupied table with probability proportional to $m_t - d$ or at an empty table with probability proportional to $k*d + c$ where $m_t$ is the number of occupants already seated at table $t$ and $k$ is the number of occupied tables.  For each table an independent draw from the base distribution determines the value for each of the $x_i$ seated there.  The common value of $x_i$ is referred to as the table label \cite{mcqeen, pitman}.

%TODO need a figure here to show restaurants arranged.  rest 1 will be the upper restaurant, rest 2 will be the lower restaurant.
These random distributions can also be arranged in a hierarchy and the Chinese restaurant process extends naturally.  In the case that $\G_2 \sim \PY(d_2, c_2, \G_1)$ and $\G_1 \sim \PY(d_1, c_1, \G_0)$, a sample can be obtained through a hierarchy of restaurant processes known as the Chinese restaurant franchise.  In the rest of this discussion restaurant one and two refer to the restaurants depicted in Figure~\ref{crfFig}. To obtain a sample the process is initiated by seating $x_1$ at an empty table in restaurant two.  The label for this table is drawn from the base distribution which is itself a random distribution.  Thus one customer must be seated in restaurant one and a table label, $y_1$, is drawn from $\G_0$.  This table label is assigned to the occupied table in both restaurant one and restaurant two.  As before $x_2 \ldots x_n$ are seated sequentially, each at a currently occupied table in restaurant two with the aforementioned probabilities.  In the restaurant franchise however, all table labels in restaurant two are drawn at the time the table becomes occupied and correspond to an additional customer being seated in restaurant one.  If the corresponding customer in restaurant one is seated at an occupied table, the table in restaurant two is assigned the same label as the table in restaurant one.  If not, both of the newly occupied tables in restaurant one and two are assigned a label drawn from $\G_0$.  At any time the number of customers in restaurant one will be equal to the number of tables in restaurant two.  The Chinese restaurant franchise makes clear the extensions of the representation to deeper hierarchies  \cite{teh et al ?}.

\subsection{Sequence Memoizer}

The sequence memoizer (SM) \cite{wood}, is a hierarchical Pitman-Yor model of unbounded depth for discrete sequence data.  Each node in the graphical model represents the distribution over the set of types ($\Sigma$) conditioned by a unique context.  The context consists of the entire sequence of types preceding the observation.  We can write the model as:

\begin{eqnarray*}
	\G_{[]} &\sim& \PY(d_0, 0, \mathcal{U}_{\Sigma }) \\
	\G_{u} &\sim& \PY(d_{|u|}, 0, \G_{\sigma(u)}) \hspace{1.5cm} \forall u \in \Sigma^+
\end{eqnarray*}

where $\mathcal{U}_{\Sigma }$ is a uniform distribution over the set of types, $u$ is a particular context, $\Sigma^+$ is the set of all such contexts, and $\sigma(u)$ is the context $u$ modified by removing the most distant type.

The major contribution of \cite{wood} was the application of the result that two Pitman-Yor processes, with 0 concentration, can be analytically integrated against one another.  The analytical result is that if $\G_2 \sim \PY(d_2, 0, \G_1)$ and  $\G_1 \sim \PY(d_1, 0, \G_0)$ then marginally, $\G_2 \sim \PY(d_2 d_2, 0, \G_0)$ \cite{someone}.  \cite{wood} show that this result allows the unpopulated tree to be built in linear time with linear space.

Inference in the SM model is performed using the Chinese restaurant franchise respresentation.  Seating the tree with a sequence takes quadratic time but maintains the linear space bound.  Quadratic time stems from the fact that seating a customer in the appropriate restaurant may require seating a customer in all of the restaurants above it.  The length of this path is bounded by the length of the sequence.  Linearity in space is maintained because a restaurant need only maintain a finite number of summary statistics, the total number of customers and the total number of tables present of each type.  From this representation of a restaurant's state the actual customer distribution over tables can be instantiated with the correct distribution if needed.
